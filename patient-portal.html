<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Patient Portal - Hospital Management System</title>
  <link rel="stylesheet" href="styles.css"> <!-- Your CSS file -->

  <style>
    :root {
      --background-color: #f4f4f4;
      --text-color: #333;
      --header-background: linear-gradient(to right, #8e0e00, #1f1c18);
      --header-text-color: #ffffff;
      --button-background: #007bff;
      --button-text-color: #ffffff;
      --section-background: rgba(255, 255, 255, 0.95);
    }
    [data-theme="night"] {
      --background-color: #121212;
      --text-color: #f1f1f1;
      --header-background: linear-gradient(to right, #1A1A2E, #1f1c18);
      --header-text-color: #ffffff;
      --button-background: #5cb85c;
      --button-text-color: #ffffff;
      --section-background: rgba(30, 30, 30, 0.95);
    }
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
    }
    header {
      background: var(--header-background);
      color: var(--header-text-color);
      padding: 20px;
      text-align: center;
    }
    header h1 {
      position: relative;
      padding: 40px 20px;
      background: url('https://media.istockphoto.com/id/638377134/photo/doctor-man-with-stethoscope-in-hospital.jpg?s=2048x2048&w=is&k=20&c=wmTKy8oac1j4PfFnJxCO-7TBho4R2lNlWzMm0Rl1gvs=') center/cover no-repeat;
      background-blend-mode: overlay;
      background-color: rgba(0, 0, 0, 0.4);
      color: #ffffff;
      font-size: 2.2rem;
      border-radius: 10px;
      margin-bottom: 12px;
    }
    #user-greeting { margin-top: -6px; font-size: 1rem; }
    nav ul { list-style: none; padding: 0; margin: 10px 0 0; }
    nav ul li { display: inline-block; margin: 0 15px; }
    nav ul li a { color: var(--header-text-color); text-decoration: none; font-weight: bold; font-size: 1.0rem; transition: transform 0.3s, color 0.3s; }
    nav ul li a:hover { color: #ffcc00; transform: scale(1.05); text-decoration: underline; }
    main { padding: 20px; max-width: 980px; margin: 0 auto; }
    section { background: var(--section-background); margin: 20px 0; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: background 0.5s; }
    h2 { color: #333; margin-top: 0; }
    footer { text-align: center; padding: 15px; background: #35424a; color: #fff; font-size: 0.9rem; }
    .button, #theme-toggle, #lang-toggle { display: inline-block; padding: 10px 20px; margin: 10px; background-color: var(--button-background); color: var(--button-text-color); border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: background-color 0.3s; text-decoration: none; }
    .button:hover, #theme-toggle:hover, #lang-toggle:hover { background-color: #0056b3; }
    .logout-btn { background-color: #dc3545; margin: 20px 10px 0 10px; }
    .logout-btn:hover { background-color: #b52b38; }
    @media (max-width: 600px) { nav ul li { display: block; margin: 10px 0; text-align:center; } }
    .ambulance-float { position: fixed; bottom: 20px; right: 20px; background-color: red; color: white; width: 70px; height: 70px; border-radius: 50%; font-size: 2.5rem; z-index: 999; display: flex; align-items: center; justify-content: center; text-decoration: none; }
    #google_translate_element { position: absolute; top: 10px; right: 10px; }
    #ai-suggestion-box { position: fixed; bottom: 100px; right: 20px; width: 320px; background: var(--section-background); color: var(--text-color); padding: 15px; border-radius: 10px; box-shadow: 0 0 10px #aaa; display: none; animation: slideIn 0.4s ease-in-out; z-index: 998; }
    #ai-suggestion-box .button { margin-top: 10px; background-color: var(--button-background); color: var(--button-text-color); }
    @keyframes slideIn { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .meta-row { display:flex; gap:12px; align-items:center; justify-content:flex-end; flex-wrap:wrap; }
    .welcome-block { display:flex; align-items:center; gap:12px; justify-content:space-between; flex-wrap:wrap; }
  </style>
</head>
<body>
  <header>
    <h1 id="main-title"> üè• Hospital Management System</h1>
    <div id="user-greeting" style="color:var(--header-text-color)"></div>
    <div id="google_translate_element"></div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="services.html">Services</a></li>
        <li><a href="contact.html">Contact Us</a></li>
        <li><a href="patient-portal.html">Patient Portal</a></li>
        <li><a href="about.html">About Us</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
      <div>
        <button id="theme-toggle" class="button">üåô</button>
        <a id="profile-settings" class="button" href="patient-records.html">My Profile</a>
      </div>
      <div class="meta-row">
        <button onclick="logout()" class="button logout-btn">üö™ Logout</button>
      </div>
    </div>

    <section>
      <h2 id="welcome">Welcome to the Patient Portal</h2>
      <p id="welcome-text">Here you can manage your appointments, view your medical records, and communicate with your healthcare providers.</p>
    </section>

    <section>
      <h2 id="appointments">Manage Your Appointments</h2>
      <p>View, book, or cancel your appointments easily.</p>
      <a id="goToAppointments" href="appointments.html" class="button">Go to Appointments</a>
    </section>

    <section>
      <h2 id="records">Access Your Medical Records</h2>
      <p>View your medical history and lab results.</p>
      <a id="viewRecords" href="patient-records.html" class="button">View Records</a>
    </section>

    <section>
      <h2 id="feedback-title">Feedback</h2>
      <p>We value your feedback. Please let us know about your experience.</p>
      <a id="submitFeedback" href="feedback.html" class="button">Submit Feedback</a>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Hospital Management System. All rights reserved.</p>
  </footer>

  <a id="ambulanceBtn" href="tel:108" class="ambulance-float" title="Call Ambulance">üöë</a>

  <div id="ai-suggestion-box" role="dialog" aria-label="Health suggestions">
    <p id="suggestion-text">üë®‚Äç‚öïÔ∏è Hello! How can I assist you today?</p>
    <a id="bookNow" href="appointments.html" class="button">üìÖ Book Appointment</a>
    <br>
    <button onclick="closeSuggestion()" class="button" style="background-color: gray; margin-top:8px;">Dismiss</button>
  </div>

  <!-- Login / Portal Script -->
  <script>
    (function initPortal() {
      const loggedInUserStr = localStorage.getItem("loggedInUser");
      if (!loggedInUserStr) {
        alert("Unauthorized! Please log in as a patient.");
        window.location.href = "login.html";
        return;
      }

      const loggedInUser = JSON.parse(loggedInUserStr);
      if (!loggedInUser.role || loggedInUser.role !== "patient") {
        alert("Unauthorized! Please log in as a patient.");
        window.location.href = "login.html";
        return;
      }

      // Greeting
      document.getElementById("user-greeting").innerHTML = `Hello, <strong>${escapeHtml(loggedInUser.username)}</strong>`;

      // Ambulance
      document.getElementById("ambulanceBtn").style.display = "flex";

      // AI Suggestion
      const lastVisitKey = `lastVisit_${loggedInUser.email}`;
      const lastVisitRaw = localStorage.getItem(lastVisitKey);
      let lastVisitDate = lastVisitRaw ? new Date(lastVisitRaw) : new Date();
      if (isNaN(lastVisitDate)) lastVisitDate = new Date();
      const today = new Date();
      const daysSinceLastVisit = Math.floor((today - lastVisitDate) / (1000*60*60*24));
      let suggestion = "üë®‚Äç‚öïÔ∏è Hello! How can I assist you today?";
      if (daysSinceLastVisit > 30) suggestion = `üïí ${escapeHtml(loggedInUser.username)}, it‚Äôs been over a month since your last checkup. Want to book an appointment?`;
      else if (daysSinceLastVisit > 15) suggestion = `üìÖ ${escapeHtml(loggedInUser.username)}, need help finding your last visit records?`;
      else suggestion = `‚úÖ ${escapeHtml(loggedInUser.username)}, everything seems fine. Let us know if you need help.`;
      document.getElementById("suggestion-text").innerText = suggestion;
      setTimeout(() => { document.getElementById("ai-suggestion-box").style.display = "block"; }, 1200);

      // Theme toggle
      const toggleButton = document.getElementById('theme-toggle');
      if (localStorage.getItem('theme') === 'night') {
        document.documentElement.setAttribute('data-theme','night'); toggleButton.textContent='üåô';
      } else { document.documentElement.setAttribute('data-theme','day'); toggleButton.textContent='‚òÄÔ∏è'; }
      toggleButton.addEventListener('click',()=>{
        const current = document.documentElement.getAttribute('data-theme');
        if(current==='night'){document.documentElement.setAttribute('data-theme','day'); localStorage.setItem('theme','day'); toggleButton.textContent='‚òÄÔ∏è';}
        else {document.documentElement.setAttribute('data-theme','night'); localStorage.setItem('theme','night'); toggleButton.textContent='üåô';}
      });

    })();

    function logout() {
      localStorage.removeItem("loggedInUser");
      alert("You have been logged out.");
      window.location.href = "login.html";
    }

    function closeSuggestion() { document.getElementById("ai-suggestion-box").style.display = "none"; }

    function escapeHtml(str) {
      if(!str) return '';
      return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
    }
  </script>

  <!-- Google Translate -->
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element');
    }
  </script>
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
